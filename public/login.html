<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Login</title>

  <link rel="stylesheet" href="style.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>

<h2>Вход</h2>

<form id="loginForm">
  <input type="text" id="loginUser" placeholder="login" required>
  <input type="password" id="loginPass" placeholder="password" required>
  <button type="submit">Войти</button>
  <div id="loginError"></div>
</form>

<h2>Регистрация</h2>

<form id="registerForm">
  <input type="text" id="regUser" placeholder="login" required>
  <input type="password" id="regPass" placeholder="password" required>

  <select id="regRole">
    <option value="client">пользователь</option>
    <option value="admin">админ</option>
  </select>

  <button type="submit">Создать</button>
</form>

<script>
  const api = "/api.php";

  $('#loginForm').on('submit', function (e) {
    e.preventDefault();

    const payload = {
      username: $('#loginUser').val(),
      password: $('#loginPass').val()
    };

    $.ajax({
      url: api + '?route=/api/login',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(payload),
      success: function (res) {
        if (!res.ok) {
          $('#loginError').text(res.error);
          return;
        }

        if (res.user.role === 'admin') {
          location.href = 'admin.html';
        } else {
          location.href = 'tickets.html';
        }
      }
    });
  });

  $('#registerForm').on('submit', function (e) {
    e.preventDefault();

    const payload = {
      username: $('#regUser').val(),
      password: $('#regPass').val(),
      role: $('#regRole').val()
    };

    $.ajax({
      url: api + '?route=/api/register',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify(payload),
      success: function () {
        alert('Аккаунт создан, теперь можно войти');
      }
    });
  });
</script>

</body>
</html>
